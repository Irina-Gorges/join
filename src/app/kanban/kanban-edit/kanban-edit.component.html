<section class="dimmed-background" (click)="handleBackdropClick($event)">
    <div class="overlay-kanban-edit" (click)="closeEditingSubtaskOnOverlay($event)">
        <div class="close-button">
            <img src="assets/img/add-contacts/Vector.svg"  alt="" />
        </div>
        <div class="testzwecken">
            <button class="prev" (click)="prevTask()">Prev</button>
            <button class="next" (click)="prevTask()">Next</button>
        </div>
        <div class="overlay-content-wrapper">
            <div class="content-in-overlay">
                <form class="kanban-overlay-form">
                    <div class="form-title kanban-div">
                        <span>Title</span>
                        <input [(ngModel)]="copyDummyTasks[currentIndex].title" name="taskTitle" placeholder="Enter a title" type="text">
                    </div>
                    <div class="form-description kanban-div">
                        <span>Description</span>
                        <textarea [(ngModel)]="copyDummyTasks[currentIndex].description" name="taskDescription"placeholder="Enter a Description "></textarea>
                    </div>
                    <div class="form-date kanban-div">
                        <span>Due date</span>
                        <input type="date" [(ngModel)]="copyDummyTasks[currentIndex].dueDate" name="taskDate"/>
                    </div>
                </form>

                <div class="kanban-edit-overlay-priority">
                    <p>Priority</p>
                    <div class="prioity-buttons">

                        <button (click)="changeToUrgent();debugPriority()" [disabled]="copyDummyTasks[currentIndex].priority === 'Urgent'"  [class.active-urgent]="copyDummyTasks[currentIndex].priority === 'Urgent'">
                            <span>Urgent</span>
                            @if(copyDummyTasks[currentIndex].priority !== 'Urgent'){
                                <img src="assets/img/kanban-edit-overlay/urgent-arrow.svg"alt=""/>
                            }@else {
                                <img src="assets/img/kanban-edit-overlay/white-urgent.svg"alt=""/>
                            }
                        </button>

                        <button (click)="changeToMedium();debugPriority()" [disabled]="copyDummyTasks[currentIndex].priority === 'Medium'"   [class.active-medium]="copyDummyTasks[currentIndex].priority === 'Medium'">
                            <span>Medium</span>
                            @if(copyDummyTasks[currentIndex].priority !== 'Medium'){
                                <img src="assets/img/kanban-edit-overlay/medium-arrow.svg"alt=""/>
                            }@else {
                                <img src="assets/img/kanban-edit-overlay/white-medium.svg"alt=""/>
                            }
                        </button>

                        <button (click)="changeToLow(); debugPriority()" [disabled]="copyDummyTasks[currentIndex].priority === 'Low'" [class.active-low]="copyDummyTasks[currentIndex].priority === 'Low'">
                            <span>Low</span>
                            @if(copyDummyTasks[currentIndex].priority !== 'Low'){
                                <img src="assets/img/kanban-edit-overlay/low-arrow.svg" alt=""/>
                            }@else{
                                <img src="assets/img/kanban-edit-overlay/white-low.svg" alt=""/>
                            }
                        </button>

                    </div>
                </div>

                <div class="kanban-assigned-to">
                    <span class="assigned-span">Assigned to</span>
                    <div class="all-user-container">
                        <mat-select panelClass="select-to-assign"  required name="name" id="" multiple>
                            @for (user of overlayState.contactList; track $index) {
                                <mat-option id={{$index}} value="$index + 1">
                                    {{user.initials}} {{user.firstName}} {{user.lastName}}
                                </mat-option>
                            }
                        </mat-select>
                    </div>
                </div>

                <div class="kanban-overlay-subtask">
                    <span>Subtask</span>
                    <div class="subtaskfield" (click)="$event.stopPropagation();">
                        <input [(ngModel)]="subtaskString" type="text"(focus)="isInputFocused = true" >
                        @if(!isInputFocused){
                            <div class="add">
                                <img src="assets/img/kanban-edit-overlay/plus-zichen.svg" alt=""/>
                            </div>
                        }@else {
                            <div class="submit-cancel">
                                <button (click)="emptySubtask()">
                                    <img  src="assets/img/kanban-edit-overlay/exit-subtask.svg" alt="">
                                </button>
                                
                                <div class="grey-line"></div>
                                <button (click)="pushToSubtask()">
                                    <img  src="assets/img/kanban-edit-overlay/checkmark-subtask.svg" alt="">
                                </button>
                            </div>
                        }
                    </div>
                    <div class="each-sub-task">
                        @for (item of copyDummyTasks[currentIndex].subTask; track $index) {
                            @if (editingSubtaskIndex === $index) {
                                <li (click)="$event.stopPropagation()">
                                    <textarea [(ngModel)]="editingSubtaskValue"></textarea>
                                    <button (click)="saveEditingSubtask($index); $event.stopPropagation()">s</button>
                                    <button (click)="cancelEditingSubtask(); $event.stopPropagation()">x</button>
                                </li>
                            }@else {
                                <li (dblclick)="startEditingSubtask($index)">
                                    {{ copyDummyTasks[currentIndex].subTask[$index]}}
                                </li>
                            }
                        }
                    </div>
                </div>
            </div>
            
            <div class="confirm-edit-button">
                <button (click)="confirmChanges()">
                    <span>Ok</span>
                    <img src="assets/img/add-contacts/check.svg" alt="" />
                </button>
            </div>
        </div>
    </div>
</section>
